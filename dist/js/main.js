var addProjectCollapse=$("#addProject"),projectInput=$(".addProject-input"),projectArrow=$(".add-project-icon.arrow"),projectPlus=$(".add-project-icon.plus");function createProject(){if(event.preventDefault(),projectInput.val()){var t=projectInput.serialize();console.log(t),console.log("Inline executed"),$.post({url:"php/create-modules/create-project.php",data:t,datatype:FormData,success:function(t){console.log("Success to contact the server"),console.log(t),"project_added"===t&&(addProjectCollapse.removeClass("show"),projectPlus.removeClass("d-none"),projectArrow.addClass("d-none"),renderProjects()),"duplicated_project"===t&&(console.log("duplicated_project"),projectInput.popover({trigger:"manual",delay:{show:250,hide:0}}),projectInput.popover("toggle"),setTimeout(function(){projectInput.popover("toggle")},4500))},error:function(){console.log("Fail to connect the server")}})}}addProjectCollapse.on("shown.bs.collapse",function(){projectInput.val(""),projectInput.focus(),projectArrow.removeClass("d-none"),projectPlus.addClass("d-none")}),addProjectCollapse.on("hidden.bs.collapse",function(){projectPlus.removeClass("d-none"),projectArrow.addClass("d-none")}),$(document).on("click",".addProject-btn",function(t){createProject()}),$(".addProject-form").on("submit",function(t){createProject()});var addTagCollapse=$("#addTag"),tagInput=$(".addTag-input"),tagArrow=$(".add-tag-icon.arrow"),tagPlus=$(".add-tag-icon.plus");function createTags(){if(event.preventDefault(),tagInput.val()){var t=$(".addTag-form").serialize();console.log(t),console.log("Inline executed"),$.post({url:"php/create-modules/create-tag.php",data:t,datatype:FormData,success:function(t){console.log("Success to contact the server"),console.log(t),"tag_added"===t&&(addTagCollapse.removeClass("show"),tagPlus.removeClass("d-none"),tagArrow.addClass("d-none"),renderTags()),"duplicated_tag"===t&&(console.log("duplicated_tag"),tagInput.popover({trigger:"manual",delay:{show:250,hide:0}}),tagInput.popover("toggle"),setTimeout(function(){tagInput.popover("toggle")},4500))},error:function(){console.log("Fail to connect the server")}})}}addTagCollapse.on("shown.bs.collapse",function(t){tagInput.val(""),tagInput.focus(),tagPlus.addClass("d-none"),tagArrow.removeClass("d-none")}),addTagCollapse.on("hidden.bs.collapse",function(){tagPlus.removeClass("d-none"),tagArrow.addClass("d-none")}),$(document).on("click",".addTag-btn",function(t){createTags()}),$(".addTag-form").on("submit",function(t){createTags()});var addTaskInlineInput=$(".addTaskInline-input"),addTaskInline=$("#addTaskInline");function createTask(t){if(event.preventDefault(),"modal"===t){if($("#taskName").val()){var o=$(".addTask-form").serialize();console.log(o),$.post({url:"php/create-modules/create-task.php",data:o,datatype:FormData,success:function(t){(console.log("Success to contact the server"),console.log(t),"task_added"===t)&&renderTasks($(".addTask-form").find("#projectSelect option:selected").text());"duplicated_tasks"===t&&(console.log("it isnot"),$("#taskName").popover({trigger:"manual",delay:{show:250,hide:0}}),$("#taskName").popover("toggle"),setTimeout(function(){$("#taskName").popover("toggle")},4500))},error:function(){console.log("Failure")}})}}else if("inline"===t&&$(".addTaskInline-input").val()){var e=$(".addTaskInline-form").serialize();console.log(e),console.log("Inline executed"),$.post({url:"php/create-modules/create-task.php",data:e,datatype:FormData,success:function(t){if(console.log("Success to contact the server"),console.log(t),"task_added"===t){var o=$(".todo-title").text().trim();$("#addTaskInline").removeClass("show"),renderTasks(o)}"duplicated_tasks"===t&&(console.log("duplicated_tasks"),addTaskInlineInput.popover({trigger:"manual",delay:{show:250,hide:0}}),addTaskInlineInput.popover("toggle"),setTimeout(function(){addTaskInlineInput.popover("toggle")},4500))},error:function(){console.log("Failure")}})}}function projectsDroppable(){$(".project-item, li.inbox-item").droppable({accept:".todo-item",tolerance:"pointer",scope:"tasks",over:function(t,o){$(this).addClass("shadow")},out:function(t,o){$(this).removeClass("shadow")},drop:function(t,o){var e=window.location.href.split("/"),n=$(this).attr("data-project-id"),a=$(o.draggable).find(".todo-label").text(),s=o.draggable.attr("data-project");console.log("Current project:"+s),console.log("Dropped task:"+a),console.log("To project:"+n),n!==s?($(o.draggable).remove(),$.post({url:"php/update-modules/update-task-project.php",data:{currentProject:s,task:a,project:n},success:function(t){console.log("Success to contact the server"),console.log(t)},error:function(){console.log("Fail to connect the server")}}),0<=e[3].indexOf("tag")?o.draggable.animate({top:0,left:0},0):$(o.draggable).remove()):(console.log("same project"),o.draggable.animate({top:0,left:0},0)),$(this).removeClass("shadow")}})}function hoverProjectControls(){$(".project-item").find(".project-right-controls").hide(),$(".project-item").hover(function(){$(this).find(".project-right-controls").fadeIn(200).show(1)},function(){$(this).find(".project-right-controls").fadeIn(200).hide(1)})}function tagsDroppable(){$(".tag-item").droppable({accept:".todo-item",tolerance:"pointer",scope:"tasks",over:function(t,o){$(this).addClass("shadow")},out:function(t,o){$(this).removeClass("shadow")},drop:function(t,o){console.log("Dropped");var e=$(".todo-title").text(),n=$(o.draggable).find(".todo-label").text(),a=$(this).find(".tag-label").text();console.log("Current project:"+e),console.log("Dropped task:"+n),console.log("To tag:"+a),$.post({url:"php/update-modules/update-task-tag.php",data:{currentProject:e,task:n,tag:a},success:function(t){console.log("Success to contact the server"),console.log(t)},error:function(){console.log("Fail to connect the server")}}),$(this).removeClass("shadow"),o.draggable.animate({top:0,left:0},0)}})}function hoverTagControls(){$(".tag-item").find(".tag-controls").hide(),$(".tag-item").hover(function(){$(this).find(".tag-controls").fadeIn(200).show(1)},function(){$(this).find(".tag-controls").fadeIn(200).hide(1)})}function tasksDraggable(){$(".todo-item").draggable({handle:".draggable-action",connectToSortable:".todo-list",revert:"invalid",scroll:!0,zIndex:2500,scope:"tasks"})}function hoverTaskControls(){$(".todo-item").find(".todo-right").hide(),$(".todo-item").hover(function(){$(this).find(".todo-right").show(1)},function(){$(this).find(".todo-right").hide(1)})}function renderProjects(){$.ajax({url:"php/render-modules/render-projects.php",type:"POST",dataType:"html",success:function(t){$(".project-list").empty(),$(".project-list").append(t),renderProjectPositions(),hoverProjectControls(),projectsDroppable()}})}function renderProjectPositions(){$(".project-item").each(function(){$(this).attr("data-project-position",$(this).index())})}function renderTags(){$.ajax({url:"php/render-modules/render-tags.php",type:"POST",dataType:"html",success:function(t){$(".tag-list").empty(),$(".tag-list").append(t)}})}addTaskInline.on("shown.bs.collapse",function(t){addTaskInlineInput.val(""),addTaskInlineInput.focus()}),$(document).on("click",".addTaskInline-btn",function(t){createTask("inline")}),$(".addTaskInline-form").on("submit",function(t){createTask("inline")}),$("#addTask").on("show.bs.modal",function(t){$("#taskName").val(""),$("#projectSelect").empty().append('<option value="Inbox" selected>Inbox</option>'),$(".project-item").find(".project-label").each(function(){console.log($(this).html()),$("#projectSelect").append('<option value="'+$(this).text()+'">'+$(this).html()+"</option>")}),$("#tagSelect").empty(),$(".tag-item").find(".tag-label").each(function(){$("#tagSelect").append('<option value="'+$(this).text()+'">#'+$(this).html()+"</option>")})}),$("#addTask").on("shown.bs.modal",function(t){$("#taskName").focus()}),$(document).on("click",".btn-addTask",function(t){createTask("modal")}),$(".addTask-form").on("submit",function(t){createTask("modal")}),$("#taskName").on("keyup blur",function(){$(this).val()?$(this).siblings(".invalid-tooltip").removeClass("d-block").addClass("d-none"):$(this).siblings(".invalid-tooltip").addClass("d-block")}),$(document).on("click",".btn-complete",function(t){event.preventDefault();var o=$(this).parents(".todo-item"),e=o.find(".todo-label").text().trim(),n=o.attr("data-project");console.log(e),$.post({url:"php/update-modules/complete-task.php",data:{tasksProject:n,task:e},success:function(t){console.log("Success to contact the server"),console.log(t),o.remove()},error:function(){console.log("Fail to connect the server")}})}),$(document).on("click",".btn-project-delete",function(t){event.preventDefault();var e=$(this).parents(".project-item").find(".project-label").text();console.log(e),$.post({url:"php/delete-modules/delete-project.php",data:{project:e},datatype:FormData,success:function(t){console.log("Success to contact the server"),console.log(t),renderProjects(),renderTasks("Inbox");var o=$(".todo-title").text();e===o&&(renderTasks("Inbox"),history.replaceState(null,null,"app.php?project=Inbox"))},error:function(){console.log("Failure")}})}),$(document).on("click",".btn-tag-delete",function(t){event.preventDefault();var o=$(this).parents(".tag-item").find(".tag-label").text();console.log(o),$.post({url:"php/delete-modules/delete-tag.php",data:{tag:o},datatype:FormData,success:function(t){console.log("Success to contact the server"),console.log(t),renderTags()},error:function(){console.log("Failure")}})}),$(document).on("click",".btn-task-delete",function(t){event.preventDefault();var o=$(this).parents(".todo-item").find(".todo-label").text();console.log(o);var e=$(".todo-title").text().trim();console.log(e),$.post({url:"php/delete-modules/delete-task.php",data:{project:e,task:o},datatype:FormData,success:function(t){console.log("Success to contact the server"),console.log(t),renderTasks(e)},error:function(){console.log("Failure")}})}),$(document).on("click",".btn-logout",function(t){$.ajax({url:"php/user-modules/user-logout.php",type:"GET",data:{logout:1},success:function(t){console.log(t)}})}),$(function(){$(".project-list").sortable({cursor:"grab",handle:".draggable-action",start:function(){},update:function(t,o){renderProjectPositions()},stop:function(t,o){updateProjectPositions()}})}),projectsDroppable(),hoverProjectControls(),tagsDroppable(),hoverTagControls(),$(function(){$(".todo-list").sortable({cursor:"grab",handle:".draggable-action",start:function(){},update:function(t,o){renderTaskPositions()},stop:function(t,o){updateTaskPositions()}})}),tasksDraggable(),hoverTaskControls(),$(document).ready(function(){$(window).scroll(function(){50<=$(window).scrollTop()?$(".navbar").addClass("navbar-change"):$(".navbar").removeClass("navbar-change")})}),renderProjectPositions();var urlArray=window.location.href.split("/");function renderTasks(o){$.ajax({url:"php/render-modules/render-tasks.php",type:"GET",dataType:"html",data:{project:o},success:function(t){$(".todo-list").empty(),$(".todo-list").append(t),hoverTaskControls(),renderProjectTitle(o),addHiddenInput(o),renderTaskPositions(),tasksDraggable()}})}function renderProjectTitle(t){$(".todo-title").text(t)}function addHiddenInput(t){$(".addTaskInline-project").val(t)}function renderTaskPositions(){$(".todo-item").each(function(){$(this).attr("data-task-position",$(this).index())})}function renderTasksByTag(o){$.ajax({url:"php/render-modules/render-tasks.php",type:"GET",dataType:"html",data:{tag:o},success:function(t){$(".todo-list").empty(),$(".todo-list").append(t),hoverTaskControls(),renderFilterTitle(o),renderTaskPositions(),tasksDraggable(),projectsDroppable()}})}function renderTasksByFilter(o){$.ajax({url:"php/render-modules/render-tasks.php",type:"GET",dataType:"html",data:{filter:o},success:function(t){$(".todo-list").empty(),$(".todo-list").append(t),hoverTaskControls(),renderFilterTitle(o),renderTaskPositions(),tasksDraggable(),projectsDroppable()}})}function renderFilterTitle(t){$(".todo-title").text(t)}function sortByPriority(t,o){return $(o).attr("data-task-priority")<=$(t).attr("data-task-priority")?1:-1}function updateTaskPositions(){var o=[],t=$(".todo-title").text().trim();$(".todo-item").each(function(){var t={};t[$(this).find(".todo-label").text()]=$(this).attr("data-task-position"),o.push(t)});var e=JSON.stringify(o);console.log(e),$.post({url:"php/update-modules/update-task-positions.php",data:{positions:e,project:t},success:function(t){console.log("Success to contact the server"),console.log(t)},error:function(){console.log("Fail to connect the server")}})}function updateProjectPositions(){var o=new Array;$(".project-item").each(function(){var t={};t[$(this).find(".project-label").text()]=$(this).attr("data-project-position"),o.push(t)});var t=JSON.stringify(o);console.log(t),$.post({url:"php/update-modules/update-project-positions.php",data:{positions:t},success:function(t){console.log("Success to contact the server"),console.log(t)},error:function(){console.log("Fail to connect the server")}})}function changePriority(t,o,e){var n=$(".todo-title").text().trim();0<=window.location.href.split("/")[3].indexOf("tag")?(console.log("Current tag:"+n),console.log("Task:"+t),console.log("New priority:"+o),$.post({url:"php/update-modules/update-task-priority.php",data:{currentTag:n,tasksProject:e,task:t,priority:o},success:function(t){console.log("Success to contact the server"),console.log(t)},error:function(){console.log("Fail to connect the server")}})):(console.log("Current project:"+n),console.log("Task:"+t),console.log("New priority:"+o),$.post({url:"php/update-modules/update-task-priority.php",data:{currentProject:n,task:t,priority:o},success:function(t){console.log("Success to contact the server"),console.log(t)},error:function(){console.log("Fail to connect the server")}}))}function changePriorityClass(t,o){t.hasClass("priority-1")?t.removeClass("priority-1"):t.hasClass("priority-2")?t.removeClass("priority-2"):t.hasClass("priority-3")?t.removeClass("priority-3"):t.removeClass("priority-4"),t.addClass("priority-"+o)}(0<=urlArray[3].indexOf("tag")||0<=urlArray[3].indexOf("filter"))&&$(".app").addClass("filter-view"),$(document).on("click","li.project-item, li.inbox-item",function(){var t=$(this).find("span").text();console.log(t),renderTasks(t),history.replaceState(null,null,"app.php?".concat($.param({project:t}))),$(".app").removeClass("filter-view")}),renderTaskPositions(),$(document).on("click","li.tag-item",function(){var t=$(this).find("span").text();console.log(t),renderTasksByTag(t),history.replaceState(null,null,"app.php?".concat($.param({tag:t}))),$(".app").addClass("filter-view")}),$(document).on("click","li.top-filter-item",function(){var t=$(this).find("span").text();console.log(t),renderTasksByFilter(t),history.replaceState(null,null,"app.php?".concat($.param({filter:t}))),$(".app").addClass("filter-view")}),$(document).on("click",".btn-todo-sort",function(t){event.preventDefault(),$(".todo-list li").sort(sortByPriority).appendTo(".todo-list"),renderTaskPositions(),updateTaskPositions()}),$(document).on("click",".priority-dropdown-item",function(t){event.preventDefault();var o=$(this).parents(".todo-item"),e=o.find(".todo-label").text(),n=o.attr("data-project");console.log(e);var a=1;$(this).hasClass("btn-priority-2")?a=2:$(this).hasClass("btn-priority-3")?a=3:$(this).hasClass("btn-priority-4")?a=a=4:(console.log(a),console.log("No")),changePriority(e,a,n),changePriorityClass(o,a),o.attr("data-task-priority",a)});